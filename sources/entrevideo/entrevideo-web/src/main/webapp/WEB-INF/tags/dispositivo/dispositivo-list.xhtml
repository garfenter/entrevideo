<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:pap="http://papiro.com.gt/components"
                xmlns:f="http://java.sun.com/jsf/core">
    <h:outputStylesheet library="dispositivo" name="css/dispositivo.css" value="css/dispositivo.css"/>
    <h:outputScript library="common" name="js/waypoints.min.js" value="js/waypoints.min.js"/>   
    <style type="text/css">              
        .ui-widget-content{
            background: none;
        }
    </style>
    <h:panelGroup id="pgCostos">
        <span style="float:right;" class="">                
            Costo:  Q
            <h:outputLabel value="#{gestionAnuncioUI.dispositivosHandler.total}">                    
            </h:outputLabel>
            /
            Saldo:  Q
            <h:outputLabel value="#{sessionUI.loggedUserSaldo}">                    
            </h:outputLabel>                                         
        </span>
    </h:panelGroup>
    <p:outputPanel autoUpdate="true">   

        <p:dataGrid columns="1" value="#{handler.dispositivos}" var="dispositivo" id="dispositivosList" rowIndexVar="row" >           

            <div class="#{row mod 2 == 0?'row-even':'row-odd'}" style="height: 128px;">                 
                <div class="left small-screen-full-width" style="width: 128px;" >
                    <img src="#{utilsUI.getServingUrl(dispositivo.fLogo)}" width="128" height="128"/>
                </div>
                <h:form id="frmPublicar" >
                    <div class="left-content datos-dispositivo small-screen-full-width">                    
                        <h:panelGroup id="disp-content">
                            <h2>
                                <p:outputLabel value="#{dispositivo.nombre} "  /> 
                            </h2><div></div>                    
                            <p:outputLabel value="#{dispositivo.descripcion} "  /> <div></div>
                            <p:outputLabel value="Precio: Q#{utilsUI.calcularPrecioAnuncio(dispositivo.dispositivo.papDispositivoJornadaList.get(0), anuncio)}"  /> <div></div>
                            <p:outputLabel value="Espacios Disponibles: #{dispositivo.dispositivo.papDispositivoJornadaList.get(0).papAnuJorList.size()}/#{dispositivo.dispositivo.papDispositivoJornadaList.get(0).anunciosMaximos}"  /><h:outputLabel value=" + #{handler.anunciosPublicar[dispositivo.dispositivo.papDispositivoJornadaList.get(0)].numeroAnuncios}" rendered="#{handler.anunciosPublicar.containsKey(dispositivo.dispositivo.papDispositivoJornadaList.get(0)) and handler.anunciosPublicar[dispositivo.dispositivo.papDispositivoJornadaList.get(0)].numeroAnuncios ge 1}"/>
                            <div></div>
                        </h:panelGroup>

                    </div>    
                    <div class="left-content accion-dispositivo small-screen-full-width">                    
                        <h:panelGroup rendered="#{!handler.anunciosPublicar.containsKey(dispositivo.dispositivo.papDispositivoJornadaList.get(0))}">
                            <p:commandButton action="#{handler.agregarAnuncioAJornada(dispositivo.dispositivo.papDispositivoJornadaList.get(0), anuncio)}" ajax="true" value="Publicar anuncio en este dispositivo" update="frmPublicar :pgCostos" process="frmPublicar"/>
                        </h:panelGroup>      
                        <h:panelGroup rendered="#{handler.anunciosPublicar.containsKey(dispositivo.dispositivo.papDispositivoJornadaList.get(0))}">
                            <div class="info-jornada-anuncio focus">    
                                <h:panelGroup rendered="#{handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)).mostrarIngreso}">
                                    <p:inputText id="itNumeroAnuncios" value="#{handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)).numeroAnuncios}"/>
                                    <p:watermark for="itNumeroAnuncios" value="Ingrese numero de espacios que desea adquirir"/><div></div>
                                    <p:commandButton action="#{handler.aceptarCambiosPublicar(handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)))}"  value="Aceptar" ajax="true" update="frmPublicar :pgCostos" process="frmPublicar"/>
                                    <p:commandButton action="#{handler.cancelarCambiosPublicar(handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)))}" ajax="true" value="Cancelar" update="frmPublicar :pgCostos" process="frmPublicar"/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{!handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)).mostrarIngreso}">
                                    <h:outputLabel value="Has reservado #{handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)).numeroAnuncios} espacios en este dispositivo"/> <div></div>
                                    <p:commandButton action="#{handler.cancelarCambiosPublicar(handler.anunciosPublicar.get(dispositivo.dispositivo.papDispositivoJornadaList.get(0)))}" ajax="true" value="Cancelar" update="frmPublicar :pgCostos" process="frmPublicar"/>
                                </h:panelGroup>
                            </div>
                        </h:panelGroup>        
                        <span class="small-screen-hidden">                                     
                            <p:lightBox id='lbImagenes'>  
                                <h:outputLink value="#{utilsUI.getServingUrl(dispositivo.fLogo)}" title="#{'Logo'}">  
                                    Ver galeria de imagenes
                                </h:outputLink>                                 
                                <h:outputLink rendered="#{dispositivo.imagenes.size() ge 1}" value="#{utilsUI.getServingUrl(dispositivo.imagenes.get(0))}" title="#{'Logo'}">                                      
                                </h:outputLink>                                 
                                <h:outputLink rendered="#{dispositivo.imagenes.size() ge 2}" value="#{utilsUI.getServingUrl(dispositivo.imagenes.get(1))}" title="#{'Logo'}">                                      
                                </h:outputLink>                                 
                                <h:outputLink rendered="#{dispositivo.imagenes.size() ge 3}" value="#{utilsUI.getServingUrl(dispositivo.imagenes.get(2))}" title="#{'Logo'}">                                      
                                </h:outputLink>                                 
                                <h:outputLink rendered="#{dispositivo.imagenes.size() ge 4}" value="#{utilsUI.getServingUrl(dispositivo.imagenes.get(3))}" title="#{'Logo'}">                                      
                                </h:outputLink>                                 
                                <h:outputLink rendered="#{dispositivo.imagenes.size() ge 5}" value="#{utilsUI.getServingUrl(dispositivo.imagenes.get(4))}" title="#{'Logo'}">                                      
                                </h:outputLink>                                 
                                
                            </p:lightBox>  

                            <p:lightBox iframe="true">  
                                <h:outputLink value="/secured/mapa/visualizar-coordenadas.jsf?latitud=#{dispositivo.latitud}&amp;longitud=#{dispositivo.longitud}&amp;titulo=#{dispositivo.nombre}" title="Visualizar en mapa">  
                                    <h:outputText value="Visualizar en mapa"/>  
                                </h:outputLink>  
                            </p:lightBox>  
                        </span>        
                    </div> 
                </h:form>                
            </div>    
            <span style="float:left;" class="separator"></span>
        </p:dataGrid>

        <h:panelGroup rendered="#{handler.moreData}">

            <script type="text/javascript">
                $(document).ready(function() {
                    $('.loadmore').waypoint(function(event, direction) {
                        if (direction == 'down') {
                            more_records();
                        }
                    }, {offset: '100%'});
                });
            </script>        

            <div class="loadmore" />
            <div class="ajax-loader"/>

            <p:remoteCommand name="more_records"
                             update="dispositivosList"
                             actionListener="#{handler.loadMore}" />
        </h:panelGroup>        
    </p:outputPanel>
</ui:composition>
